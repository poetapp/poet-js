# Po.et JS

[![Build Status](https://travis-ci.org/poetapp/poet-js.svg?branch=master)](https://travis-ci.org/poetapp/poet-js)
[![Renovate enabled](https://img.shields.io/badge/renovate-enabled-brightgreen.svg)](https://renovatebot.com/)
[![semantic-release](https://img.shields.io/badge/%20%20%F0%9F%93%A6%F0%9F%9A%80-semantic--release-e10079.svg)](https://github.com/semantic-release/semantic-release)
[![Join the chat at https://gitter.im/poetapp/Lobby](https://badges.gitter.im/poetapp/Lobby.svg)](https://gitter.im/poetapp/Lobby)

Po.et JS is a small library that provides methods to easily create and sign Po.et Claims. 

## Installation

```
npm i @po.et/poet-js
```

## Usage

The main function you'll be using is `createClaim`:

### Example 1: createClaim for Work Claims <!-- TODO: link to glossary -->

```ts
import { Claim, ClaimType, createClaim } from '@po.et/poet-js' 

const workAttributes = {
  name: 'The Raven',
  author: 'Edgar Allan Poe',
  tags: 'poem',
  dateCreated: '',
  datePublished: '1845-01-29T03:00:00.000Z',
  content: 'Once upon a midnight dreary...'
}

const Issuer = 'po.et://entities/<identity claim id>'
 
const claim = createClaim(
  Issuer,
  ClaimType.Work,
  workAttributes
)
```

Once this claim is created, you can publish it to a Po.et Node:

```ts
const response = await fetch(poetNodeUrl + '/works/', {
  method: 'POST',
  headers: {
	'Accept': 'application/json',
	'Content-Type': 'application/json'
  },
  body: JSON.stringify(claim)
})
```

Note, if you are creating an identity claim, your Identity Provider (IDP) <!-- TODO: link to glossary --> will be the issuer of the claim. If you are self-serving your own IDP, you will have to create an IdentityClaim for the IDP from which you can issue all further identities.

### Example 2: createClaim for Identity Claims <!-- TODO: link to glossary -->

```ts
import { Claim, ClaimType, createClaim } from '@po.et/poet-js'

const identityAttributes = {
  publicKey: ''
}

const Issuer = 'po.et://entities/<idp identity claim id>'

const claim = createClaim(
  Issuer,
  ClaimType.Identity,
  identityAttributes
) 
```

Once this claim is created, you can publish it to a Po.et Node:

```ts
const response = await fetch(poetNodeUrl + '/identities/', {
  method: 'POST',
  headers: {
	'Accept': 'application/json',
	'Content-Type': 'application/json'
  },
  body: JSON.stringify(claim)
})
```

Notice you don't need to wait for the server's response to know the claim's ID. You don't even need to publish it! `claim.id` is readily available right after calling `createClaim`.

## Contributing

### Compiling

Run `npm run build` to compile the source. This will run TypeScript on the source files and place the output in `dist/ts`, and will then run Babel and place the output in `dist/babel`.

Currently, we're only using Babel to support [absolute import paths](https://github.com/tleunen/babel-plugin-module-resolver) in the unit tests. This is due to how TypeScript and Babel process absolute paths. On build, TypeScript transforms the .ts files into .js and places type definitions in .d.ts files. Babel, with the module-resolver plugin, will then transform the absolute paths in these .js files into relative paths, but will leave the .d.ts unchanged, which still have absolute paths. This causes issues with clients of the library that want to use these TypeScript definitions.   

### Tests

Run all tests with `npm test`.

### Coverage

Coverage reports are created with [Istanbul](https://github.com/istanbuljs/nyc), which can be generated by running `npm run coverage`.

<!-- TODO: This area needs some reviewing; the reports look a bit off sometimes. Also, we'll want the Travis job to check that coverage doesn't go down with pull requests. -->

### Branches and Pull Requests

The master branch is blocked - no one can commit to it directly. To contribute changes, branch off of master and make a pull request back to it. Travis CI will run all tests automatically for all submitted pull requests, including linting (`npm run lint`). You can run `npm run lint:fix` for quick, automatic lint fixes.
